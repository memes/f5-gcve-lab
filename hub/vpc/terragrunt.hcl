dependencies {
  paths = [
    "${get_repo_root()}/foundations/",
  ]
}

dependency "foundations" {
  config_path = "${get_repo_root()}/foundations/"
  mock_outputs = {
    prefix = "mock-prefix"
  }
}

include "root" {
  path   = find_in_parent_folders()
  expose = true
}

include "env" {
  path   = find_in_parent_folders("env.hcl")
  expose = true
}

include "restricted-vpc" {
  path = "${get_repo_root()}/_components/restricted-vpc.hcl"
}

remote_state = include.root.remote_state

inputs = {
  project_id  = try(include.root.inputs.network_project_id, include.root.inputs.project_id)
  name        = format("%s-%s", dependency.foundations.outputs.prefix, include.env.locals.name)
  description = format("%s VPC", title(include.env.locals.name))
  regions     = include.root.inputs.regions
  labels      = try(include.root.inputs.labels, {})
  cidrs = {
    primary_ipv4_cidr          = "10.10.0.0/16"
    primary_ipv4_subnet_size   = 24
    primary_ipv4_subnet_offset = 10
    primary_ipv4_subnet_step   = 1
    primary_ipv6_cidr          = null
    secondaries                = null
  }
}
