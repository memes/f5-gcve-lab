dependencies {
  paths = [
    "${get_repo_root()}/foundations/",
    "${get_repo_root()}/hub/vpc/"
  ]
}

dependency "foundations" {
  config_path = "${get_repo_root()}/foundations/"
  mock_outputs = {
    prefix = "mock-prefix"
  }
}

dependency "vpc" {
  config_path = "${get_repo_root()}/hub/vpc/"
  mock_outputs = {
    self_link = "https://www.googleapis.com/compute/v1/projects/mock-project/global/networks/mock-restricted"
  }
}

terraform {
  source = "${get_repo_root()}/gcve/private_cloud/"
}

include "root" {
  path   = find_in_parent_folders()
  expose = true
}

remote_state = include.root.remote_state

inputs = {
  name          = dependency.foundations.outputs.prefix
  project_id    = include.root.inputs.project_id
  locations     = coalescelist(try(include.root.inputs.locations, []), formatlist("%s-a", slice(include.root.inputs.regions, 0, 1)))
  vpc_self_link = dependency.vpc.outputs.self_link
}
